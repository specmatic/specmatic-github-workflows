#!/usr/bin/env ruby
require 'yaml'
require_relative '../lib/logger'

dependabot_updates = [
  {
    "package-ecosystem" => "github-actions",
    "directory" => "/",
    "schedule" => {
      "interval" => "daily"
    }
  }
]

file_filters = {
  '.github/dependabot.{yml,yaml}' => 'github-actions',
  'settings.gradle,{.kts}' => 'gradle',
  'Dockerfile' => 'docker',
  'yarn.lock' => 'yarn',
  'package-lock.json' => 'npm',
}

file_filters.each do |filter, ecosystem|
  if Dir.glob(filter).any?
    info "Found #{filter}, adding dependabot config for #{ecosystem}"
    dependabot_updates << {
      "package-ecosystem" => ecosystem,
      "open-pull-requests-limit" => 25,
      "directory" => "/",
      "schedule" => {
        "interval" => "daily"
      }
    }
  end
end

File.write(".github/dependabot.yml", {"version" => 2, "updates" => dependabot_updates}.to_yaml.sub(/^---\n/, '# This file was auto-generated by setup-dependabot script.'))
